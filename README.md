# img - Image helper: convert and resize to WebP

A small CLI to convert, resize, and normalize image files. It is a thin wrapper
around `cwebp` (part of libwebp) and forwards many operations to that tool.
Because `cwebp` does the heavy lifting, `cwebp` must be installed and available
in your `PATH` for conversions and resizing.

## Installation

Build locally:

- Build in-place:

  `go build ./cmd`

- Install to your Go bin:

  `go install github.com/jlrickert/cmd-img/cmd@latest`

Install `cwebp` (libwebp)

- Debian / Ubuntu:

  `sudo apt update && sudo apt install -y libwebp-tools`

- macOS (Homebrew):

  `brew install webp`

- Windows:

  - Use Chocolatey: `choco install webp`, or
  - Use Scoop: `scoop install webp`, or
  - Download binaries from the official WebP site:
    https://developers.google.com/speed/webp/download

Verify installation:

- `cwebp -version` or `cwebp -h`

## Usage

Run `img` to see help. Common usage patterns:

- Forward arguments to `cwebp` (default behavior when no subcommand is used):

  `img -version -q 80 input.png -o out.webp`

- Convert a single file to WebP:

  `img convert input.jpg`

  Output: `input.webp`

- Convert all JPG and PNG files in the current tree:

  `img convert-all`

  This walks the current directory recursively and converts `.jpg`, `.jpeg`, and
  `.png` files to `.webp`.

- Resize an image and write a dimension-suffixed file:

  `img resize --file input.png --width 800 --height 600 [cwebp args...]`

  Output example: `input-w800-h600.png` (extension preserved).

  If `--width` or `--height` is `0`, the missing dimension is inferred from the
  intermediate image generated by `cwebp`. Extra args are passed to `cwebp`.

- Normalize filenames (lowercase, spaces to hyphen, collapse hyphens):

  `img normalize "My Photo.JPG" "Another File.PNG"`

  By default this creates normalized copies. Use `--delete` to remove originals
  after creating the normalized file.

- Normalize all files in the current directory (non recursive):

  `img normalize-all [--delete]`

## Shell completion

Generate completion scripts:

- Bash:

  `img completion bash > /etc/bash_completion.d/img`

- Zsh:

  `img completion zsh > ~/.zsh/completion/_img`

- Fish:

  `img completion fish > ~/.config/fish/completions/img.fish`

- PowerShell:

  `img completion powershell > img.ps1`

## Behavior details

- The default command forwards all arguments to `cwebp` and requires that
  `cwebp` is available in `PATH`.

- `convert` and `convert-all` rely on `cwebp` to perform conversions.

- `resize` creates a temporary WebP via `cwebp -resize` then writes a final file
  with the original extension but with `-w{w}-h{h}` inserted.

- `normalize` rules for the filename base:
  - convert to lowercase
  - replace whitespace sequences with `-`
  - collapse repeated `-`
  - trim leading and trailing `-`
  - if the result is empty the name `file` is used

## Dependencies

- `cwebp` (part of libwebp) must be installed and reachable via `PATH`.
- `file` utility is required for detecting image dimensions.
- `identify` from ImageMagick is an optional fallback to detect dimensions.
- `bash` is required for `runShell` invocations used in some helpers.

## Requirements

- `cwebp` must be in `PATH` for conversion and resize operations.
- The `file` utility is used to detect dimensions when needed.
- `identify` from ImageMagick is used as a fallback for dimensions if `file`
  output cannot be parsed.
- `bash` is used for `runShell` invocations.

## Files of interest

- Main program: `./cmd/img.go`
- Library and CLI: `cmd.go`
- Helper functions and tests are in the repository root and subdirs.

## Examples

Convert a single image:

`img convert photo.jpg`

Resize keeping aspect ratio for height (auto width):

`img resize --file photo.png --width 0 --height 300 -q 80`

Normalize a single filename and delete the original:

`img normalize --delete "My Photo.JPG"`

Convert everything under the current directory:

`img convert-all`

## Contributing

Contributions and issues are welcome. Please open a pull request or an issue on
the project repo. See repository for contribution guidelines and license
information.
